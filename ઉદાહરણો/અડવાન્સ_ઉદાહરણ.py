#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
અડવાન્સ ઉદાહરણ - ગુજરાતી પાઈથનમાં અડવાન્સ ફીચર્સ

આ ફાઈલ ગુજરાતી પાઈથનના એડવાન્સ ફીચર્સ દર્શાવે છે:
- ફાઈલ હેન્ડલિંગ
- JSON પ્રોસેસિંગ  
- Decorators
- Context Managers
- List Comprehensions
- Generators
"""

ઈમ્પોર્ટ json
ઈમ્પોર્ટ os
ઈમ્પોર્ટ અવિકલ
માંથી datetime ઈમ્પોર્ટ datetime

# ડેકોરેટર ઉદાહરણ
ડેફ સમય_માપવો(ફંક્શન):
    """
    ફંક્શન એક્ઝીક્યુશન ટાઇમ માપવા માટેનો ડેકોરેટર
    """
    ડેફ આવરણ(*args, **kwargs):
        શરૂઆત = અવિકલ.time()
        પરિણામ = ફંક્શન(*args, **kwargs)
        અંત = અવિકલ.time()
        છાપો(f"⏱️ {ફંક્શન.__name__} માટે લાગ્યો સમય: {અંત - શરૂઆત:.4f} સેકંડ")
        પરત આપો પરિણામ
    પરત આપો આવરણ

ડેફ લોગ_કરો(મેસેજ):
    """
    સમય સાથે લોગ મેસેજ આપે છે
    """
    હાલનો_સમય = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    છાપો(f"[{હાલનો_સમય}] {મેસેજ}")

# ક્લાસ ડેફિનેશન સાથે કન્ટેક્સ્ટ મેનેજર
ક્લાસ ફાઈલ_મેનેજર:
    """
    ફાઈલ હેન્ડલિંગ માટેનો કન્ટેક્સ્ટ મેનેજર
    """
    
    ડેફ __init__(સ્વ, ફાઈલ_નામ, મોડ):
        સ્વ.ફાઈલ_નામ = ફાઈલ_નામ
        સ્વ.મોડ = મોડ
        સ્વ.ફાઈલ = કંઈ નહીં
    
    ડેફ __enter__(સ્વ):
        લોગ_કરો(f"ફાઈલ ખોલી રહ્યા છીએ: {સ્વ.ફાઈલ_નામ}")
        સ્વ.ફાઈલ = ઓપન(સ્વ.ફાઈલ_નામ, સ્વ.મોડ, encoding='utf-8')
        પરત આપો સ્વ.ફાઈલ
    
    ડેફ __exit__(સ્વ, એક્સ_ટાઈપ, એક્સ_વેલ્યુ, ટ્રેસબેક):
        જો સ્વ.ફાઈલ:
            સ્વ.ફાઈલ.close()
            લોગ_કરો(f"ફાઈલ બંધ કરી: {સ્વ.ફાઈલ_નામ}")

# JSON ડેટા પ્રોસેસિંગ ક્લાસ
ક્લાસ ડેટા_પ્રોસેસર:
    """
    JSON ડેટા પ્રોસેસિંગ માટેનો ક્લાસ
    """
    
    ડેફ __init__(સ્વ, ફાઈલ_પાથ):
        સ્વ.ફાઈલ_પાથ = ફાઈલ_પાથ
        સ્વ.ડેટા = {}
    
    @સમય_માપવો
    ડેફ ડેટા_લોડ_કરો(સ્વ):
        """
        JSON ફાઈલથી ડેટા લોડ કરે છે
        """
        પ્રયત્ન કરો:
            સાથે ફાઈલ_મેનેજર(સ્વ.ફાઈલ_પાથ, 'r') આસ f:
                સ્વ.ડેટા = json.load(f)
                લોગ_કરો(f"ડેટા લોડ થયો: {લેન(સ્વ.ડેટા)} આઈટમ્સ")
        સિવાય FileNotFoundError:
            લોગ_કરો("ફાઈલ મળી નથી, નવો ડેટા બનાવી રહ્યા છીએ")
            સ્વ.ડેટા = {"વ્યક્તિઓ": [], "કુલ_ગણતરી": 0}
        સિવાય json.JSONDecodeError આસ e:
            લોગ_કરો(f"JSON એરર: {e}")
            સ્વ.ડેટા = {}
    
    @સમય_માપવો
    ડેફ ડેટા_સેવ_કરો(સ્વ):
        """
        JSON ફાઈલમાં ડેટા સેવ કરે છે
        """
        સાથે ફાઈલ_મેનેજર(સ્વ.ફાઈલ_પાથ, 'w') આસ f:
            json.dump(સ્વ.ડેટા, f, ensure_ascii=False, indent=2)
            લોગ_કરો("ડેટા સેવ થયો")
    
    ડેફ વ્યક્તિ_ઉમેરો(સ્વ, નામ, ઉંમર, શહેર):
        """
        નવી વ્યક્તિ ઉમેરે છે
        """
        નવી_વ્યક્તિ = {
            "id": સ્વ.ડેટા.get("કુલ_ગણતરી", 0) + 1,
            "નામ": નામ,
            "ઉંમર": ઉંમર,
            "શહેર": શહેર,
            "ઉમેર્યા_તારીખ": datetime.now().isoformat()
        }
        
        જો "વ્યક્તિઓ" નહીં ઇન સ્વ.ડેટા:
            સ્વ.ડેટા["વ્યક્તિઓ"] = []
        
        સ્વ.ડેટા["વ્યક્તિઓ"].append(નવી_વ્યક્તિ)
        સ્વ.ડેટા["કુલ_ગણતરી"] = સ્વ.ડેટા.get("કુલ_ગણતરી", 0) + 1
        
        લોગ_કરો(f"વ્યક્તિ ઉમેરાઈ: {નામ}")
    
    ડેફ વ્યક્તિઓ_શોધો(સ્વ, શહેર=કંઈ નહીં, ઉંમર_મિન=કંઈ નહીં, ઉંમર_મેક્સ=કંઈ નહીં):
        """
        વ્યક્તિઓને ફિલ્ટર કરીને શોધે છે
        """
        વ્યક્તિઓ = સ્વ.ડેટા.get("વ્યક્તિઓ", [])
        
        # લિસ્ટ કોમ્પ્રિહેન્શન સાથે ફિલ્ટરિંગ
        ફિલ્ટર_પરિણામ = [
            વ્યક્તિ ફોર વ્યક્તિ ઇન વ્યક્તિઓ
            જો (શહેર છે કંઈ નહીં અથવા વ્યક્તિ["શહેર"] == શહેર) અને
               (ઉંમર_મિન છે કંઈ નહીં અથવા વ્યક્તિ["ઉંમર"] >= ઉંમર_મિન) અને
               (ઉંમર_મેક્સ છે કંઈ નહીં અથવા વ્યક્તિ["ઉંમર"] <= ઉંમર_મેક્સ)
        ]
        
        પરત આપો ફિલ્ટર_પરિણામ
    
    ડેફ આંકડા_બતાવો(સ્વ):
        """
        ડેટાના આંકડા બતાવે છે
        """
        વ્યક્તિઓ = સ્વ.ડેટા.get("વ્યક્તિઓ", [])
        
        જો નહીં વ્યક્તિઓ:
            છાપો("કોઈ ડેટા નથી")
            પરત આપો
        
        # આંકડાકીય ગણતરી
        કુલ_વ્યક્તિઓ = લેન(વ્યક્તિઓ)
        ઉંમરોની_યાદી = [વ્યક્તિ["ઉંમર"] ફોર વ્યક્તિ ઇન વ્યક્તિઓ]
        
        સરેરાશ_ઉંમર = સમ(ઉંમરોની_યાદી) / કુલ_વ્યક્તિઓ
        મિન_ઉંમર = મિન(ઉંમરોની_યાદી)
        મેક્સ_ઉંમર = મેક્સ(ઉંમરોની_યાદી)
        
        # શહેરવાર ગણતરી
        શહેર_ગણતરી = {}
        ફોર વ્યક્તિ ઇન વ્યક્તિઓ:
            શહેર = વ્યક્તિ["શહેર"]
            શહેર_ગણતરી[શહેર] = શહેર_ગણતરી.get(શહેર, 0) + 1
        
        છાપો("\nડેટા આંકડા:")
        છાપો("-" * 40)
        છાપો(f"કુલ વ્યક્તિઓ: {કુલ_વ્યક્તિઓ}")
        છાપો(f"સરેરાશ ઉંમર: {સરેરાશ_ઉંમર:.1f}")
        છાપો(f"મિનિમમ ઉંમર: {મિન_ઉંમર}")
        છાપો(f"મેક્ઝિમમ ઉંમર: {મેક્સ_ઉંમર}")
        
        છાપો(f"\nશહેરવાર વિતરણ:")
        ફોર શહેર, ગણતરી ઇન શહેર_ગણતરી.items():
            ટકા = (ગણતરી / કુલ_વ્યક્તિઓ) * 100
            છાપો(f"  {શહેર}: {ગણતરી} ({ટકા:.1f}%)")

# જનરેટર ફંક્શન
ડેફ ફિબોનાચી_જનરેટર(n):
    """
    ફિબોનાચી સિક્વેન્સ જનરેટ કરે છે
    """
    a, b = 0, 1
    ગણતરી = 0
    
    વ્હાઈલ ગણતરી < n:
        પ્રદાન કરો a
        a, b = b, a + b
        ગણતરી += 1

ડેફ ફંક્શનલ_પ્રોગ્રામિંગ_દેખાડો():
    """
    ફંક્શનલ પ્રોગ્રામિંગ કન્સેપ્ટ્સ દર્શાવે છે
    """
    છાપો("\nફંક્શનલ પ્રોગ્રામિંગ:")
    
    નંબર્સ = લિસ્ટ(રેંજ(1, 11))
    છાપો(f"મૂળ નંબર્સ: {નંબર્સ}")
    
    # map ફંક્શન
    વર્ગ = લિસ્ટ(મેપ(લેમ્બડા x: x**2, નંબર્સ))
    છાપો(f"વર્ગ: {વર્ગ}")
    
    # filter ફંક્શન  
    સમ_નંબર્સ = લિસ્ટ(ફિલ્ટર(લેમ્બડા x: x % 2 == 0, નંબર્સ))
    છાપો(f"સમ નંબર્સ: {સમ_નંબર્સ}")
    
    # reduce (functools નથી import કર્યું તેથી manual)
    પ્રોડક્ટ = 1
    ફોર num ઇન નંબર્સ[:5]:  # પહેલા 5 નંબર્સ
        પ્રોડક્ટ *= num
    છાપો(f"પહેલા 5 નંબર્સનો ગુણાકાર: {પ્રોડક્ટ}")

@સમય_માપવો
ડેફ મેઇન_ડેમો():
    """
    મુખ્ય ડેમો ફંક્શન
    """
    છાપો("ગુજરાતી પાઈથન અડવાન્સ ફીચર્સ")
    છાપો("=" * 60)
    
    # ફાઈલ નેમ
    ડેટા_ફાઈલ = "/tmp/ગુજરાતી_ડેટા.json"
    
    # ડેટા પ્રોસેસર બનાવો
    પ્રોસેસર = ડેટા_પ્રોસેસર(ડેટા_ફાઈલ)
    
    # ડેટા લોડ કરો
    પ્રોસેસર.ડેટા_લોડ_કરો()
    
    # નમૂના ડેટા ઉમેરો
    નમૂના_વ્યક્તિઓ = [
        ("અશોક", 28, "અમદાવાદ"),
        ("પ્રિયા", 24, "સુરત"),
        ("રાજ", 35, "બડોદરા"),
        ("દીપિકા", 29, "રાજકોટ"),
        ("મિતુલ", 32, "અમદાવાદ"),
        ("નીરજા", 27, "સુરત")
    ]
    
    ફોર નામ, ઉંમર, શહેર ઇન નમૂના_વ્યક્તિઓ:
        પ્રોસેસર.વ્યક્તિ_ઉમેરો(નામ, ઉંમર, શહેર)
    
    # ડેટા સેવ કરો
    પ્રોસેસર.ડેટા_સેવ_કરો()
    
    # આંકડા બતાવો
    પ્રોસેસર.આંકડા_બતાવો()
    
    # સર્ચ કરો
    છાપો("\nસર્ચ પરિણામો:")
    અમદાવાદી_લોકો = પ્રોસેસર.વ્યક્તિઓ_શોધો(શહેર="અમદાવાદ")
    છાપો(f"અમદાવાદના {લેન(અમદાવાદી_લોકો)} લોકો:")
    ફોર વ્યક્તિ ઇન અમદાવાદી_લોકો:
        છાપો(f"  - {વ્યક્તિ['નામ']} ({વ્યક્તિ['ઉંમર']} વર્ષ)")
    
    યુવાન_લોકો = પ્રોસેસર.વ્યક્તિઓ_શોધો(ઉંમર_મેક્સ=30)
    છાપો(f"\n30 વર્ષથી નાના {લેન(યુવાન_લોકો)} લોકો:")
    ફોર વ્યક્તિ ઇન યુવાન_લોકો:
        છાપો(f"  - {વ્યક્તિ['નામ']} ({વ્યક્તિ['ઉંમર']} વર્ષ, {વ્યક્તિ['શહેર']})")
    
    # જનરેટર ડેમો
    છાપો("\nફિબોનાચી સિક્વન્સ (પહેલા 10):")
    ફિબ_નંબર્સ = લિસ્ટ(ફિબોનાચી_જનરેટર(10))
    છાપો(f"  {ફિબ_નંબર્સ}")
    
    # ફંક્શનલ પ્રોગ્રામિંગ ડેમો
    ફંક્શનલ_પ્રોગ્રામિંગ_દેખાડો()
    
    # ફાઈલ ડિલીટ કરો (ક્લીનઅપ)
    પ્રયત્ન કરો:
        os.remove(ડેટા_ફાઈલ)
        લોગ_કરો("ફાઈલ ડિલીટ કરી")
    સિવાય FileNotFoundError:
        પાસ
    
    છાપો("\n" + "=" * 60)
    છાપો("અડવાન્સ ફીચર્સ ડેમો પૂર્ણ!")

જો __name__ == "__main__":
    મેઇન_ડેમો()